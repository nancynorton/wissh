<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Metadata -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WISSH</title>

    <!-- Stylesheets -->
    <link rel="stylesheet" href="node_modules/@xterm/xterm/css/xterm.css">

    <!-- Scripts -->
    <script src="node_modules/@xterm/xterm/lib/xterm.js"></script>
    <script src="node_modules/@xterm/addon-attach/lib/addon-attach.js"></script>
    <script src="node_modules/@xterm/addon-fit/lib/addon-fit.js"></script>
    <!--<script src="node_modules/@xterm/addon-webgl/lib/addon-webgl.js"></script>-->
</head>
<body>
    <div id="terminal"></div>
    <script>
        const terminal = new Terminal();
        //terminal.loadAddon(new WebglAddon.WebglAddon());

        const ws = new WebSocket(`ws://${window.location.host}/xterm`);
        terminal.loadAddon(new AttachAddon.AttachAddon(ws));

        const fitAddon = new FitAddon.FitAddon();
        terminal.loadAddon(fitAddon);

        ws.onopen = (event) => {
            terminal.open(document.getElementById('terminal'));
            fitAddon.fit();
            ws.send(JSON.stringify({ resize: { cols: terminal.cols, rows: terminal.rows } }));
        };

        window.addEventListener('resize', () => {
            fitAddon.fit();
            /* TODO: Come up with a more robust solution for communicating resize events */
            ws.send(JSON.stringify({ resize: { cols: terminal.cols, rows: terminal.rows } }));
        });
    </script>
</body>
</html>
